---
title: "Olympic Gymnastics EDA"
author: "WIll Gertsch"
date: "July 21, 2018"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

## Introduction

Gymnastics is a sport that I believe has a lot of potential for analytic. There is a decent amount of data and domain knowledge of the sport is challenging but rewarding to work with. My goal for this analysis is to explore how gymnasts have changed over the years.

## The Data

The dataset that I'm working with is <https://www.kaggle.com/heesoo37/120-years-of-olympic-history-athletes-and-results>. It comes as a csv file, so I'll just go ahead and load it from my project directory.

```{r load data, message=FALSE}
athlete_events <- read_csv("athlete_events.csv")
```

Now that the data is loaded, let's get a general idea of what fields we are dealing with.
```{r}
head(athlete_events)
```

Now since this is an exploration of gymnastics at the Olympics, we will need to filter the data down to just gymnastics. The problem is that I have no idea what gymnastics is called in the data. I know I want to filter on the "Sport" column, but I don't know which value(s) to filter by. 
```{r}
unique(athlete_events[str_detect(athlete_events$Sport, "Gymnastics"), "Sport"])
```
We have found two sports by looking for the word "Gymnastics." We want to choose the "Gymnastics" value to filter our data since it refers to Artistic Gymnastics, which is the kind that most people think of when they think of the sport.
```{r, warning=FALSE}
gym <- filter(athlete_events, Sport=="Gymnastics")
```

Now we have the data for just gymnastics. I want to additionally prune this data to get rid of some columns we don't really need. ID should correspond to the athlete name, but some athletes may have the same name. Team and NOC basically represent the same thing, so we can drop one and just use the other. I will use the "Team" column since it is easier to understand than the NOC system. In other case, there is the issue  of names changing over time. We will need to clean that aspect up if we ever want to group by a particular country. Games and Season are not useful because gymnastics is always in the summer games and the year is taken care of by the Year column. City will not provide any useful insight because it really isn't connected to any of the other variables. Finally, Sport will also be removed because all its values are now the same.

I also changed the units used in Height and Weight from metric to imperial.
```{r}
gym <- gym[, c("ID", "Name", "Sex", "Age", "Height", "Weight", "Team", "Year", "Event", "Medal")] %>% 
  mutate(Height=round(Height*(0.0328084),1),
         Weight = round(Weight*(2.20462)))
```

Let's look at our data again.
```{r}
head(gym)
```
That looks a lot more usable!

## Plots
Now we can start getting an idea of what the data looks like visually.


### Distribution
It is helpful to get an idea of how the data is distributed.

For these kind of plots, we don't want the same athletes to show up multiple times. The solution is to make a copy of the data that only has the distinct IDs.
```{r distinct ids}
gym_distinct <- gym %>% distinct(ID, .keep_all = TRUE)
```

Now we can start plotting.
```{r sex dist}
ggplot(gym_distinct, aes(x=Sex, fill = Sex))+geom_bar()
```
There are 2,635 males and 1,499 females in total.


```{r age dist}
ggplot(gym_distinct, aes(x=Age, color = Sex))+geom_freqpoly(na.rm = TRUE, binwidth=1)
```

```{r average ages}
gym_distinct %>% filter(Sex == "M") %>% .$Age %>% mean(na.rm=TRUE)
gym_distinct %>% filter(Sex == "F") %>% .$Age %>% mean(na.rm=TRUE)
```
The average male age is around 24 and the average female age is around 19. Another thing to note is that at age 16, there are massive numbers of female gymnasts and very few male athletes. These peaks reflect age requirements set by the sport's international governing body and the optimal age more success at the Olympic level.


We can do a similar thing for Height.
```{r height dist}
gym_distinct %>% ggplot(aes(x=Height, color=Sex))+geom_freqpoly(na.rm=TRUE, binwidth = 0.1)
```

```{r average heights}
gym_distinct %>% filter(Sex == "M") %>% .$Height %>% mean(na.rm=TRUE)
gym_distinct %>% filter(Sex == "F") %>% .$Height %>% mean(na.rm=TRUE)
```

The average male height is around 5'6″ while the average for women is around 5'1″.

Finally, the distribution of Weight.
```{r weight dist}
gym_distinct %>% ggplot(aes(x=Weight, color=Sex))+geom_freqpoly(na.rm=TRUE, binwidth=5)
```

```{r average weights}
gym_distinct %>% filter(Sex == "M") %>% .$Weight %>% mean(na.rm=TRUE)
gym_distinct %>% filter(Sex == "F") %>% .$Weight %>% mean(na.rm=TRUE)
```
The average weight for men is around 140 lbs. while the average weight for women is around 104 pounds.


```{r year dist}
gym_distinct %>% 
  mutate(Year = as.character(Year)) %>% 
  ggplot(aes(x=Year, fill=Sex))+
  geom_bar(na.rm=TRUE)+
  coord_flip()
```

This plot shows that women  did not compete at the Olympic level in the sport until 1928 and then slowly rose in number relative to the male athletes until the present day where the gymnastics has close to at 50-50 male to female ratio. However, the sport seems to be getting more selective in recent years. 

There may be something wrong with the data at certain years, since some years have a huge number of athletes for the time. This is worth investigating. Let's first see what years are outliers.
```{r outlier years}
gym_distinct %>% 
  group_by(Year) %>% 
  summarise(count = n()) %>% 
  ggplot(aes(y=count))+geom_boxplot()
```

It looks like the outlier years are 1908 and 1952. (1896 and 1932 are also outliers, but on the low end) 

We can take a closer look at these weird years.
```{r weird years}
years <- c(1908,1952, 2016)
gym_strange_years <- gym_distinct %>% 
  mutate(Year = as.character(Year)) %>% 
  filter(Year %in% years)
gym_strange_years %>% ggplot(aes(x=Year))+geom_bar(fill="brown")
```
This is a closer look at the years in question. All these years have 50+ more athletes than other years. 1908 has close to 150 more athletes than the 2016 games. 


One issue might be teams could be huge. The Wikipedia states that each team could be between 16 and 40 gymnasts on a team. Let's look at how many people were on each team.
```{r 1908 team counts}
gym_distinct %>% 
  filter(Year == 1908, Event == "Gymnastics Men's Team All-Around") %>% 
  group_by(Team) %>% 
  summarise(count = n())
```

Sure enough, those are some massive teams(looking at you GB). This explains why 1908 had so many competitors.



### Age, Height, Weight over time
Let's start by looking at the age of the athletes.

```{r age scatter, warning=FALSE}
ggplot(gym, aes(x=Year,y=Age, color=Sex))+geom_jitter()
```

This plot is not very helpful because of how bunched together the data is, even with jittering. Even so, we can get a few things out of this graph:
* Confirmation that men in gymnastics tend to be older.
* Athletes seem to get younger with a minimum in the 80's and then get older again.

Let's try a different plot to see if we can get more insight:
```{r age smooth plot, warning=FALSE, message=FALSE}
ggplot(gym, aes(x=Year, y=Age, color=Sex))+geom_smooth()
```

This is a much more useful graph that confirms some of the things we hypothesized earlier. It is easy to see that men are older and that athlete ages for both sexes was at a minimum in the 80's.


```{r height smooth plot, warning=FALSE, message=FALSE}
ggplot(gym, aes(x=Year, y=Height, color=Sex))+geom_smooth()
```

Unsurprisingly, men are taller than women on average. There also appears to be some interesting phenomenon with the variation in age. On the men's side, the average height seems to have stabilized with very little variation year to year since the 1950's. The womens graph is a little more erratic, suggesting significant changes year to year and a decent amount of variance within years.


```{r weight smooth plot, warning=FALSE, message=FALSE}
ggplot(gym, aes(x=Year, y=Weight, color=Sex))+geom_smooth()
```

This plot looks very similar to the Height plot, probably because taller athletes will weigh more than shorted athletes.



```{R, warning=FALSE}
ggplot(gym, aes(x=Weight, y=Height, color=Sex))+geom_point()
```
```{r, warning=FALSE}
cor(gym$Weight, gym$Height, use="complete.obs")
```

Unsurprisingly, athlete height and weight are strongly correlated.

### Medals
Let's do some work investigating just the medalists.
```{r medal processing}
medalists <- gym %>% filter(!is.na(Medal))
```

One of the most popular things to do is to do a medal count by country, so let's do that.
```{r medals by country plot}
# get the top 10 teams by total medal count
top_teams <- medalists %>% 
  group_by(Team) %>% 
  summarise(total = n()) %>% 
  arrange(desc(total)) %>% 
  .$Team %>% 
  head(20) %>%
  rev()

# filter down medalists to just to those 10 teams
top_medals <- medalists %>% filter(Team %in% top_teams)

# for reordering the plot
top_medals$Team <- factor(top_medals$Team, levels=top_teams)
top_medals$Medal <- factor(top_medals$Medal, levels=c("Gold", "Silver", "Bronze"))

top_medals %>% 
  group_by(Team, Medal) %>% 
  summarise(total = n()) %>% 
  ggplot(aes(x=Team, y = total, fill = Medal)) +
  geom_bar(stat="identity") + 
  coord_flip()+
  scale_fill_manual(values=c("#FFD700", "#D3D3D3", "#cd7f32")) + 
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"))
  

```

The Soviet Union is clearly the leader in total medal count of *{r echo=FALSE} top_medals %>% group_by(Team) %>% summarise(total=n()) %>% .$total %>% max()*, which is way ahead of the USA in second place with 177 medals. It also leads in the number of golds and silvers.

```{r medals over time}
# famously dominate teams
dominate_teams <- c("Soviet Union", "United States", "Japan", "China", "Russia", "Romania")
dominate_medals <- medalists %>%
  filter(Team %in% dominate_teams) %>%
  group_by(Team, Year) %>% 
  summarise(medals=n())
            
dominate_medals %>%  ggplot(aes(x=Year, y=medals, color=Team))+geom_line()
  
```

This is a very messy plot and its hard to tell what's going on, especially in more recent years. It will be better to look at the teams individually and pairwise.

```{r soviet union to russia}
dominate_medals %>%
  filter(Team == "Soviet Union" || Team == "Russia") %>%
  ggplot(aes(x=Year, y=medals, color=Team))+geom_line()
```

The Soviet Union started out very well, but their medal count sharply fell over the next few decades. Despite this, the previous two plots tell us that the Soviet teams were still the best team in world at the time. This dominance was continued by the Russian team in the 1996 and 2000 games, but the team soon slid down the medal rankings below some of the other dominate teams. However, Russia's team placements in 2012 and 2016 have shown that they are still a dominate force in the sport.

```{r soviets and japan}
dominate_medals %>%
  filter(Team == "Soviet Union" || Team == "Japan") %>%
  ggplot(aes(x=Year, y=medals, color=Team))+geom_line()
```

Between the 1960's and the 1980's, Japan proved to be a serious challenge to Soviet gymnastics supremacy. I theorize that the Japanese might be one of the significant causes of the Soviet's decline in medal count during this period. (Would probably use cross-correlation from time series analysis; too advanced for this EDA)  Japan also wins an award for being very consistently good for the last 20 years.

```{r USA and China}
dominate_medals %>%
  filter(Team == "United States" || Team == "China") %>%
  ggplot(aes(x=Year, y=medals, color=Team))+geom_line()
```

This is very interesting. It seems that China's medal performance might be related to the United States's medal performance. My theory for this is that China and USA have very comparable teams and their medal counts will respond similarly to external factors, such as other teams becoming stronger or weaker.